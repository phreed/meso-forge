# yaml-language-server: $schema=https://raw.githubusercontent.com/prefix-dev/recipe-format/main/schema.json
schema_version: 1

context:
  version: 5.1.4

package:
  name: node-red-worldmap
  version: ${{ version }}

source:
  git: https://github.com/dceejay/RedMap.git
  rev: e5cdd1258dc62b553d0f753892adf53e2e9f577c
  target_directory: node-red-worldmap
  # url: https://registry.npmjs.org/node-red-contrib-web-worldmap/-/node-red-worldmap-${{ version }}.tgz
  # sha256: 06db0a456ec02c74954b6e01400da3f881835c3384617c63d788f95b444291ae
  # file_name: node-red-worldmap-${{ version }}.tgz

build:
  script:
    interpreter: nu
    content: |
      $"building ($env.PKG_NAME)!"

      # Install dependencies in the source directory
      cd node-red-worldmap
      npm install

      # Create target directory and copy files
      let target_dir = $"($env.PREFIX)/lib/node_modules/node-red-contrib-web-worldmap"
      mkdir $target_dir
      cp -r * $target_dir

requirements:
  build:
    - nushell
    - nodejs
    - node-red
  host:
    - nodejs
  run:
    - nodejs

tests:
  # Test 1: Verify package contents are included
  - package_contents:
      files:
        # Node-RED Worldmap Node.js package
        - ${{ "Library/" if win }}lib/node_modules/node-red-contrib-web-worldmap/package.json

  # Test 2: Functional test
  - requirements:
      build:
        - nushell
    script:
      interpreter: nu
      content:
        - ^echo 'not sure how to test'

about:
  homepage: https://github.com/dceejay/RedMap#readme
  summary: A Node-RED node to provide a world map web page for plotting "things" on.
  description: |
    Plots "things" on a map.
      By default the map will be served from {httpRoot}/worldmap,
      but this can be changed in the configuration panel.
  license: Apache-2.0
  license_file:
    - node-red-worldmap/LICENSE
  documentation: https://github.com/dceejay/RedMap#readme
  repository: https://github.com/dceejay/RedMap

extra:
  recipe-maintainers:
    - phreed
