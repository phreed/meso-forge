"$schema" = "https://pixi.sh/v0.43.1/schema/manifest/schema.json"

[workspace]
name = "meso-forge"
version = "0.1.0"
description = "Packages needed by my projects"
authors = ["Wolf Vollprecht <w.vollprecht@gmail.com>", "Fred Eisele <fred.eisele@vanderbilt.edu>"]
channels = ["conda-forge"]
platforms = ["osx-arm64", "linux-64", "win-64", "osx-64"]
preview = ["pixi-build"]

[feature.update-ver.dependencies]
python = "3.12.*"
requests = ">=2.32.3,<3"
pyyaml = ">=6.0.2,<7"
semver = ">=3.0.2,<4"

[feature.update-ver.tasks]
update-ver = { cmd = ["python", ".scripts/update-versions.py" ] }

[feature.build-all.dependencies]
rattler-build = ">=0.31.1,<0.32"

[feature.build-all.tasks]
build-all = { cmd = [
  "rattler-build", "build",
  "--recipe-dir", "./packages",
  "--skip-existing=all",
  "--target-platform=$TARGET_PLATFORM",
  "--channel", "https://prefix.dev/meso-forge",
  "--channel", "conda-forge",
  "-vvv",
], env = { TARGET_PLATFORM = 'linux-64' } }

[feature.upload-all.dependencies]
deno = ">=2.2.5,<3"

[feature.upload-all.tasks]
upload-all = { cmd = [ 
  "deno", "run", ".scripts/upload-all.ts"
] }

[environments]
update = { features = ["update-ver"] }
build = { features = ["build-all"] }
upload = { features = ["upload-all"] }

